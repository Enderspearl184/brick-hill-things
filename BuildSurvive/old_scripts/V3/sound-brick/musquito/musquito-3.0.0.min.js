/*!
*  musquito v3.0.0
*  http://musquitojs.com
*
*  (c) 2020 Vijaya Anand
*  http://prideparrot.com
*
*  MIT License
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("$buzz",[],t):"object"==typeof exports?exports.$buzz=t():e.$buzz=t()}(window,(function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=7)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._navigator=null,this._contextType=null,this._formats={},this._userAgent=null,"undefined"!=typeof navigator&&(this._navigator=navigator,this._userAgent=navigator.userAgent),"undefined"!=typeof AudioContext?this._contextType=AudioContext:"undefined"!=typeof webkitAudioContext&&(this._contextType=webkitAudioContext);var t=new Audio;this._formats={mp3:Boolean(t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:Boolean(t.canPlayType("audio/mpeg;").replace(/^no$/,"")),opus:Boolean(t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")),ogg:Boolean(t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")),oga:Boolean(t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")),wav:Boolean(t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")),aac:Boolean(t.canPlayType("audio/aac;").replace(/^no$/,"")),caf:Boolean(t.canPlayType("audio/x-caf;").replace(/^no$/,"")),m4a:Boolean((t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,"")),mp4:Boolean((t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,"")),weba:Boolean(t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:Boolean(t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:Boolean(t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,"")),flac:Boolean((t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,""))},t=null}return n(e,[{key:"id",value:function(){return Math.round(Date.now()*Math.random())}},{key:"getContextType",value:function(){return this._contextType}},{key:"getContext",value:function(){return new this._contextType}},{key:"supportedFormats",value:function(){return this._formats}},{key:"isFormatSupported",value:function(e){return Boolean(this._formats[e])}},{key:"getSupportedFormat",value:function(e){var t=this;return e.find((function(e){return t.isFormatSupported(e)}))}},{key:"isSourceSupported",value:function(e){var t=this.isBase64(e)?/^data:audio\/([^;,]+);/i.exec(e):/^.+\.([^.]+)$/.exec(e);return!!(t=/^.+\.([^.]+)$/.exec(e))&&this.isFormatSupported(t[1].toLowerCase())}},{key:"getSupportedSource",value:function(e){var t=this;return e.find((function(e){return t.isSourceSupported(e)}))}},{key:"isBase64",value:function(e){return/^data:[^;]+;base64,/.test(e)}},{key:"_isMobile",value:function(){return!!this._navigator&&/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(this._userAgent)}},{key:"_isTouch",value:function(){return"undefined"!=typeof window&&Boolean("ontouchend"in window||this._navigator&&this._navigator.maxTouchPoints>0||this._navigator&&this._navigator.msMaxTouchPoints>0)}},{key:"isIE",value:function(){return Boolean(this._userAgent&&/MSIE |Trident\//.test(this._userAgent))}},{key:"destroyHtml5Audio",value:function(e){e.pause(),this.isIE()&&(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),e.onerror=null,e.onend=null,e.canplaythrough=null}}]),e}();t.default=new r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={Success:"success",Failure:"error"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorType=t.EngineEvents=t.EngineState=t.default=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=f(i(8)),s=f(i(9)),a=f(i(4)),u=f(i(5)),l=f(i(0)),d=f(i(6)),h=f(i(1));function f(e){return e&&e.__esModule?e:{default:e}}var c={NoAudio:"no-audio",LoadError:"load",PlayError:"play",EngineError:"engine"},_={NotReady:"notready",Ready:"ready",Suspending:"suspending",Suspended:"suspended",Resuming:"resuming",Destroying:"destroying",Done:"done",NoAudio:"no-audio"},y={Init:"init",Volume:"volume",Mute:"mute",Stop:"stop",Suspend:"suspend",Resume:"resume",Error:"error",Done:"done"},p=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","pointerup","touchend","keydown","keyup"],v=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=l.default.id(),this._muted=!1,this._volume=1,this._maxNodesPerSource=10,this._cleanUpInterval=5,this._inactiveTime=2,this._autoEnable=!0,this._intervalId=null,this._isAudioAvailable=!1,this._state=_.NotReady,this._context=null,this._gainNode=null,this._queue=null,this._buzzesArray=[],this._soundsArray=[],this._bufferLoader=null,this._mediaLoader=null,this._sourceRegistry={},this._queue=new u.default,this._resumeAndRemoveListeners=this._resumeAndRemoveListeners.bind(this),this.free=this.free.bind(this)}return r(e,[{key:"setup",value:function(e){var t=this;if(this._state!==_.NotReady)return this;if(this._context=l.default.getContext(),this._isAudioAvailable=Boolean(this._context),!this._isAudioAvailable)return this._state=_.NoAudio,this._fire(y.Error,{type:c.NoAudio,error:"Web Audio API is not available"}),this;var i=e||{},r=i.volume,a=i.muted,u=i.maxNodesPerSource,d=i.cleanUpInterval,h=i.inactiveTime,f=i.autoEnable,v=i.src,m=i.preload,b=void 0===m||m,g=i.progress,k=i.oninit,A=i.onstop,S=i.onmute,E=i.onvolume,P=i.onsuspend,T=i.onresume,w=i.onerror,N=i.ondone;if("number"==typeof r&&r>=0&&r<=1&&(this._volume=r),"boolean"==typeof a&&(this._muted=a),"number"==typeof u&&(this._maxNodesPerSource=u),"number"==typeof d&&(this._cleanUpInterval=d),"number"==typeof h&&(this._inactiveTime=h),"boolean"==typeof f&&(this._autoEnable=f),"function"==typeof k&&this.on(y.Init,k),"function"==typeof A&&this.on(y.Stop,A),"function"==typeof S&&this.on(y.Mute,S),"function"==typeof E&&this.on(y.Volume,E),"function"==typeof P&&this.on(y.Suspend,P),"function"==typeof T&&this.on(y.Resume,T),"function"==typeof w&&this.on(y.Error,w),"function"==typeof N&&this.on(y.Done,N),this._bufferLoader=new o.default(this._context),this._mediaLoader=new s.default(this._maxNodesPerSource,this._inactiveTime,(function(e){t._freeSounds(),t._buzzesArray.forEach((function(t){return t.getCompatibleSource()===e&&t.free()}))})),this._autoEnable&&"suspended"===this._context.state&&p.forEach((function(e){return document.addEventListener(e,t._resumeAndRemoveListeners)})),this._gainNode=this._context.createGain(),this._gainNode.gain.setValueAtTime(this._muted?0:this._volume,this._context.currentTime),this._gainNode.connect(this._context.destination),this._intervalId=window.setInterval(this.free,60*this._cleanUpInterval*1e3),this._state="suspended"!==this._context.state?_.Ready:_.Suspended,"object"===(void 0===v?"undefined":n(v)))if(Object.keys(v).forEach((function(e){return t.register(v[e],e)})),b){var C=function(e){return e.map((function(e){var i=[],r=[];if("string"==typeof e)i=[e];else if(Array.isArray(e))i=e;else if("object"===(void 0===e?"undefined":n(e))){var o=e.url,s=e.format,a=void 0===s?[]:s;"string"==typeof o?i=[o]:Array.isArray(o)&&(i=o),r=a}return t._getCompatibleSource(i,r)}))},x=C(Object.values(v).filter((function(e){return!e.stream}))),L=C(Object.values(v).filter((function(e){return e.stream})));Promise.all([this.load(x,g),this.loadMedia(L)]).then((function(e){return t._fire(y.Init,e)}))}else this._fire(y.Init);return this}},{key:"play",value:function(e){var t=this;if("number"==typeof e){var i=this.sound(e);return i&&i.play(),this}var r=[],o=[],s=null,a=null,u={};if("string"==typeof e)if(e.startsWith("#")){var l=e.split("."),f=l[0].substring(1);a=l[1];var _=this._getSourceInfo(f);r=_.audioSrc,o=_.audioFormat,s=_.audioSprite}else r=[e];else if(Array.isArray(e))r=e;else if("object"===(void 0===e?"undefined":n(e))){var y=e.id,p=e.src,v=e.format,m=e.sprite,b=e.sound,g=e.stream,k=e.volume,A=e.rate,S=e.loop,E=e.muted,P=e.loadCallback,T=e.playEndCallback,w=e.destroyCallback,N=e.fadeEndCallback,C=e.audioErrorCallback;if("string"==typeof p)if(p.startsWith("#")){var x=p.split(".")[0].substring(1),L=this._getSourceInfo(x);r=L.audioSrc,o=L.audioFormat,s=L.audioSprite}else r=[p];else Array.isArray(p)&&(r=p);Array.isArray(v)?o=v:"string"==typeof v&&v&&(o=[v]),"number"==typeof y&&(u.id=y),"object"===(void 0===m?"undefined":n(m))&&(s=m),"string"==typeof b&&(a=b),"boolean"==typeof g&&(u.stream=g),"number"==typeof k&&k>=0&&k<=1&&(u.volume=k),"number"==typeof A&&A>=.5&&A<=5&&(u.rate=A),"boolean"==typeof E&&(u.muted=E),"boolean"==typeof S&&(u.loop=S),"function"==typeof P&&(u.loadCallback=P),"function"==typeof T&&(u.playEndCallback=T),"function"==typeof w&&(u.destroyCallback=w),"function"==typeof N&&(u.fadeEndCallback=N),"function"==typeof C&&(u.audioErrorCallback=C)}if(!r.length)throw new Error("You should pass the source for the audio.");this.setup();var M=u.stream,I=u.loadCallback,O=u.audioErrorCallback,R=u.destroyCallback;if(!this.isAudioAvailable())return O&&O({type:c.NoAudio,error:"Web Audio is un-available"}),this;var j=this._getCompatibleSource(r,o);if(u.destroyCallback=function(e){t._removeSound(e),t.releaseForSound(j,t._id,e.id()),R&&R(e)},"string"==typeof a&&s&&s.hasOwnProperty(a)){var F=s[a];u.startPos=F[0],u.endPos=F[1]}var B=new d.default(u);return B._gain().connect(this._gainNode),this._soundsArray.push(B),(M?this.allocateForGroup(j,this._id):this.load(j)).then((function(e){e.status===h.default.Success&&(B.source(M?t.allocateForSound(j,t._id,B.id()):e.value),t._play(B)),I&&I(e,B)})),B.id()}},{key:"pause",value:function(e){var t=this.sound(e);return t&&t.pause(),this}},{key:"stop",value:function(e){if(void 0!==e){var t=this.sound(e);return t&&t.stop(),this}return this.buzzes().forEach((function(e){return e.stop()})),this.sounds().forEach((function(e){return e.stop()})),this._fire(y.Stop),this}},{key:"mute",value:function(e){if(void 0!==e){var t=this.sound(e);return t&&t.mute(),this}return this._muted?this:(this._gainNode.gain.setValueAtTime(0,this._context.currentTime),this._muted=!0,this._fire(y.Mute,this._muted),this)}},{key:"unmute",value:function(e){if(void 0!==e){var t=this.sound(e);return t&&t.unmute(),this}return this._muted?(this._gainNode.gain.setValueAtTime(this._volume,this._context.currentTime),this._muted=!1,this._fire(y.Mute,this._muted),this):this}},{key:"volume",value:function(e,t){if(void 0!==t){var i=this.sound(t);if(i)return void 0===e?i.volume():(i.volume(e),this)}return void 0===e?this._volume:"number"!=typeof e||e<0||e>1?this:(this._gainNode.gain.setValueAtTime(this._muted?0:e,this._context.currentTime),this._volume=e,this._fire(y.Volume,this._volume),this)}},{key:"fade",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"linear",r=this.sound(e);return r&&r.fade(t,i,n),this}},{key:"fadeStop",value:function(e){var t=this.sound(e);return t&&t.fadeStop(),this}},{key:"rate",value:function(e,t){var i=this.sound(e);if(i){if(void 0===t)return i.rate();i.rate(t)}return this}},{key:"seek",value:function(e,t){var i=this.sound(e);if(i){if(void 0===t)return i.seek();i.seek(t)}return this}},{key:"loop",value:function(e,t){var i=this.sound(e);if(i){if(void 0===t)return i.loop();i.loop(t)}return this}},{key:"destroy",value:function(e){var t=this.sound(e);return t&&t.destroy(),this}},{key:"suspend",value:function(){var e=this;return this._state===_.Resuming?(this._queue.add("after-resume","suspend",(function(){return e.suspend()})),this):this._state!==_.Ready?this:(this.stop(),this._state=_.Suspending,this._context.suspend().then((function(){e._state=_.Suspended,e._queue.run("after-suspend"),e._fire(y.Suspend)})),this)}},{key:"resume",value:function(){var e=this;return this._state===_.Suspending?(this._queue.add("after-suspend","resume",(function(){return e.resume()})),this):this._state!==_.Suspended?this:(this._state=_.Resuming,this._context.resume().then((function(){e._state=_.Ready,e._queue.run("after-resume"),e._fire(y.Resume)})),this)}},{key:"terminate",value:function(){var e=this;if(this._state===_.Done||this._state===_.Destroying)return this;var t=function(){p.forEach((function(t){return document.addEventListener(t,e._resumeAndRemoveListeners)})),e._intervalId&&window.clearInterval(e._intervalId),e._intervalId=null,e._buzzesArray.forEach((function(e){return e.destroy()})),e._soundsArray.forEach((function(e){return e.destroy()})),e._bufferLoader&&(e._bufferLoader.dispose(),e._bufferLoader=null),e._mediaLoader&&(e._mediaLoader.dispose(),e._mediaLoader=null),e._buzzesArray=[],e._soundsArray=[],e._context=null,e._queue.clear(),e._queue=null,e._state=_.Done,e._fire(y.Done),a.default.clear(e._id)};if(this._context){if(this._state===_.Suspending)return this._queue.remove("after-suspend"),this._queue.add("after-suspend","destroy",(function(){return e.terminate()})),this;if(this._state===_.Resuming)return this._queue.remove("after-resume"),this._queue.add("after-resume","destroy",(function(){return e.terminate()})),this;this._state=_.Destroying,this._context&&this._context.close().then((function(){return t()}))}else this._state=_.Destroying,t();return this}},{key:"register",value:function(e,t){return this._sourceRegistry.hasOwnProperty(t)?this:(this._sourceRegistry[t]=e,this)}},{key:"unregister",value:function(e,t){return delete this._sourceRegistry[t],this}},{key:"getSource",value:function(e){return this._sourceRegistry[e]}},{key:"load",value:function(e,t){return this._bufferLoader.load(e,t)}},{key:"loadMedia",value:function(e){return this._mediaLoader.load(e)}},{key:"add",value:function(e){return this._buzzesArray.indexOf(e)>-1?this:(this._buzzesArray.push(e),this)}},{key:"remove",value:function(e){return this._buzzesArray.splice(this._buzzesArray.indexOf(e),1),this}},{key:"allocateForGroup",value:function(e,t){return this._mediaLoader.allocateForGroup(e,t)}},{key:"allocateForSound",value:function(e,t,i){return this._mediaLoader.allocateForSound(e,t,i)}},{key:"unload",value:function(e){return e?(this._bufferLoader.unload(e),this):(this._bufferLoader.unload(),this)}},{key:"unloadMedia",value:function(e){return e?(this._mediaLoader.unload(e),this):(this._mediaLoader.unload(),this)}},{key:"releaseForGroup",value:function(e,t){return this._mediaLoader.releaseForGroup(e,t),this}},{key:"releaseForSound",value:function(e,t,i){this._mediaLoader.releaseForSound(e,t,i)}},{key:"hasFreeNodes",value:function(e,t){return this._mediaLoader.hasFreeNodes(e,t)}},{key:"on",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return a.default.on(this._id,e,t,i),this}},{key:"off",value:function(e,t){return a.default.off(this._id,e,t),this}},{key:"free",value:function(){return this._freeSounds(),this._buzzesArray.forEach((function(e){return e.free()})),this._mediaLoader.cleanUp(),this}},{key:"muted",value:function(){return this._muted}},{key:"state",value:function(){return this._state}},{key:"context",value:function(){return this._context}},{key:"masterGain",value:function(){return this._gainNode}},{key:"isAudioAvailable",value:function(){return this._isAudioAvailable}},{key:"bufferLoader",value:function(){return this._bufferLoader}},{key:"mediaLoader",value:function(){return this._mediaLoader}},{key:"buzz",value:function(e){return this._buzzesArray.find((function(t){return t.id()===e}))}},{key:"buzzes",value:function(){return this._buzzesArray}},{key:"sound",value:function(e){return this._soundsArray.find((function(t){return t.id()===e}))}},{key:"sounds",value:function(){return this._soundsArray}},{key:"inactiveTime",value:function(){return this._inactiveTime}},{key:"_getSourceInfo",value:function(e){var t=this.getSource(e),i={audioSrc:[],audioFormat:[],audioSprite:null};if("string"==typeof t)i.audioSrc=[t];else if(Array.isArray(t))i.audioSrc=t;else if("object"===(void 0===t?"undefined":n(t))){var r=t.url,o=t.format,s=t.sprite;"string"==typeof r?i.audioSrc=[r]:Array.isArray(r)&&(i.audioSrc=r),Array.isArray(o)?i.format=o:"string"==typeof o&&o&&(i.format=[o]),"object"===(void 0===s?"undefined":n(s))&&(i.audioSprite=s)}return i}},{key:"_fire",value:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return a.default.fire.apply(a.default,[this._id,e].concat(i,[this])),this}},{key:"_resumeAndRemoveListeners",value:function(){var e=this;this.resume(),p.forEach((function(t){return document.addEventListener(t,e._resumeAndRemoveListeners)}))}},{key:"_removeSound",value:function(e){"number"!=typeof e?this._soundsArray.splice(this._soundsArray.indexOf(e),1):this._soundsArray=this._soundsArray.filter((function(t){return t.id()!==e}))}},{key:"_getCompatibleSource",value:function(e,t){return t.length?e[t.indexOf(l.default.getSupportedFormat(t))]:l.default.getSupportedSource(e)}},{key:"_play",value:function(e){var t=e.audioErrorCallback;if(this._state!==_.Destroying&&this._state!==_.Done){if(this._state!==_.NoAudio)return[_.Suspending,_.Suspended,_.Resuming].indexOf(this._state)>-1?(this._queue.add("after-resume","sound-"+e.id(),(function(){return e.play()})),void(this._state!==_.Resuming&&this.resume())):void e.play();t&&t({type:c.NoAudio,error:"Web Audio is un-available"},e)}else t&&t({type:c.PlayError,error:"The engine is stopping/stopped"},e)}},{key:"_freeSounds",value:function(){var e=this,t=new Date;this._soundsArray=this._soundsArray.filter((function(i){var n=(t-i.lastPlayed())/1e3;return!!(i.isPersistent()||i.isPlaying()||i.isPaused()||n<60*e.inactiveTime())||(i.destroy(),!1)}))}}]),e}());t.default=v,t.EngineState=_,t.EngineEvents=y,t.ErrorType=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=i(1),o=(n=r)&&n.__esModule?n:{default:n};t.default=function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=null,this.value=null,this.error=null,this.status=null,this.url=t,this.value=i,this.error=n||null,this.status=n?o.default.Failure:o.default.Success}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._objectsEventsHandlersMap={}}return n(e,[{key:"on",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._hasObject(e)||(this._objectsEventsHandlersMap[e]={});var r=this._objectsEventsHandlersMap[e];return r.hasOwnProperty(t)||(r[t]=[]),r[t].push({handler:i,once:n}),this}},{key:"off",value:function(e,t,i){if(!this._hasEvent(e,t))return this;var n=this._objectsEventsHandlersMap[e];return n[t]=i?n[t].filter((function(e){return e.handler!==i})):[],this}},{key:"fire",value:function(e,t){for(var i=arguments.length,n=Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];if(!this._hasEvent(e,t))return this;for(var o=this._objectsEventsHandlersMap[e][t],s=0;s<o.length;s++){var a=o[s];setTimeout(function(i){var r=i.handler,o=i.once;r.apply(void 0,n),o&&this.off(e,t,r)}.bind(this,a),0)}return this}},{key:"clear",value:function(e){return e?(this._hasObject(e)&&delete this._objectsEventsHandlersMap[e],this):(this._objectsEventsHandlersMap={},this)}},{key:"_hasObject",value:function(e){return this._objectsEventsHandlersMap.hasOwnProperty(e)}},{key:"_hasEvent",value:function(e,t){return this._hasObject(e)&&this._objectsEventsHandlersMap[e].hasOwnProperty(t)}}]),e}();t.default=new r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._eventActions={}}return n(e,[{key:"add",value:function(e,t,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.hasEvent(e)||(this._eventActions[e]={}),this._eventActions[e][t]={fn:i,removeAfterRun:n}}},{key:"hasEvent",value:function(e){return this._eventActions.hasOwnProperty(e)}},{key:"hasAction",value:function(e,t){return!!this.hasEvent(e)&&this._eventActions[e].hasOwnProperty(t)}},{key:"run",value:function(e,t){var i=this;if(this.hasEvent(e))if(void 0===t)Object.keys(this._eventActions[e]).forEach((function(t){return i._run(e,t)}));else{if(!this.hasAction(e,t))return;this._run(e,t)}}},{key:"remove",value:function(e,t){this._eventActions.hasOwnProperty(e)&&(t?delete this._eventActions[e][t]:delete this._eventActions[e])}},{key:"clear",value:function(){this._eventActions={}}},{key:"_run",value:function(e,t){var i=this._eventActions[e][t];i.fn(),i.removeAfterRun&&this.remove(e,t)}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SoundState=t.default=void 0;var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=u(i(2)),s=u(i(0)),a=u(i(11));function u(e){return e&&e.__esModule?e:{default:e}}var l={Ready:"ready",Playing:"playing",Paused:"paused",Destroyed:"destroyed"},d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=-1,this._volume=1,this._rate=1,this._muted=!1,this._loop=!1,this._state=l.Ready,this._context=null,this._gainNode=null,this._stream=!1,this._buffer=null,this._audio=null,this._bufferSourceNode=null,this._duration=0,this._startPos=0,this._endPos=0,this._currentPos=0,this._rateSeek=0,this._startTime=0,this._loadCallback=null,this._playEndCallback=null,this._destroyCallback=null,this._fading=!1,this._fadeTimer=null,this._fadeEndCallback=null,this._audioErrorCallback=null,this._mediaElementAudioSourceNode=null,this._endTimer=null,this._isSprite=!1,this._lastPlayed=new Date,this._persist=!1,this._sourceExists=!1,this._loaded=!1,this._onBufferEnded=this._onBufferEnded.bind(this),this._onHtml5Ended=this._onHtml5Ended.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onAudioError=this._onAudioError.bind(this);var i=t.id,n=t.stream,r=t.buffer,a=t.audio,u=t.volume,d=t.rate,h=t.loop,f=t.muted,c=t.startPos,_=t.endPos,y=t.loadCallback,p=t.playEndCallback,v=t.destroyCallback,m=t.fadeEndCallback,b=t.audioErrorCallback;this._id="number"==typeof i?i:s.default.id(),this._buffer=r,this._audio=a,this._sourceExists=Boolean(this._buffer)||Boolean(this._audio),this._stream=n,this._sourceExists&&(this._endPos=this._stream?this._audio.duration:this._buffer.duration),u&&(this._volume=u),d&&(this._rate=d),f&&(this._muted=f),h&&(this._loop=h),c&&(this._startPos=c),_&&(this._endPos=_),this._loadCallback=y,this._playEndCallback=p,this._destroyCallback=v,this._fadeEndCallback=m,this._audioErrorCallback=b,this._duration=this._endPos-this._startPos,this._isSprite=void 0!==_,this._stream&&this._audio&&(this._audio.playbackRate=this._rate,this._setLoop(this._loop),this._audio.addEventListener("error",this._onAudioError)),o.default.isAudioAvailable()&&(this._context=o.default.context(),this._gainNode=this._context.createGain(),this._gainNode.gain.setValueAtTime(this._muted?0:this._volume,this._context.currentTime),this._stream&&this._audio&&(this._mediaElementAudioSourceNode=this._context.createMediaElementSource(this._audio),this._mediaElementAudioSourceNode.connect(this._gainNode)))}return r(e,[{key:"source",value:function(e){this._sourceExists||(this._stream?(this._audio=e,!this._isSprite&&(this._endPos=this._audio.duration),this._audio.playbackRate=this._rate,this._setLoop(this._loop),this._audio.addEventListener("error",this._onAudioError),this._mediaElementAudioSourceNode=this._context.createMediaElementSource(this._audio),this._mediaElementAudioSourceNode.connect(this._gainNode)):(this._buffer=e,!this._isSprite&&(this._endPos=this._buffer.duration)),this._sourceExists=!0,this._duration=this._endPos-this._startPos,this._loaded=!0)}},{key:"load",value:function(){this._stream&&this._sourceExists&&!this.isPlaying()&&this.state()!==l.Destroyed&&(this._audio.addEventListener("canplaythrough",this._onCanPlayThrough),this._audio.currentTime=0,this.canPlay()&&this._onCanPlayThrough())}},{key:"play",value:function(){return!this._sourceExists||this.isPlaying()?this:(this._stream?this._playHtml5():this._playBuffer(),this._startTime=this._context.currentTime,this._state=l.Playing,this)}},{key:"pause",value:function(){return this._sourceExists&&this.isPlaying()?(this.fadeStop(),this._stream?(this._audio.removeEventListener("ended",this._onHtml5Ended),this._clearEndTimer(),this._audio.pause()):(this._rateSeek=0,this._destroyBufferNode()),this._currentPos=this.seek(),this._state=l.Paused,this):this}},{key:"stop",value:function(){return this._sourceExists&&(this.isPlaying()||this.isPaused())?(this.fadeStop(),this._stream?(this._audio.removeEventListener("ended",this._onHtml5Ended),this._clearEndTimer(),this._audio.pause(),this._audio.currentTime=this._startPos||0):(this._currentPos=0,this._rateSeek=0,this._destroyBufferNode()),this._lastPlayed=new Date,this._state=l.Ready,this):this}},{key:"mute",value:function(){return this.fadeStop(),this._gainNode.gain.setValueAtTime(0,this._context.currentTime),this._muted=!0,this}},{key:"unmute",value:function(){return this.fadeStop(),this._gainNode.gain.setValueAtTime(this._volume,this._context.currentTime),this._muted=!1,this}},{key:"volume",value:function(e){return void 0===e?this._volume:(this.fadeStop(),this._gainNode.gain.setValueAtTime(this._muted?0:e,this._context.currentTime),this._volume=e,this)}},{key:"fade",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"linear";return this._fading&&this.fadeStop(),this._fading=!0,"linear"===n?this._gainNode.gain.linearRampToValueAtTime(e,this._context.currentTime+t):this._gainNode.gain.exponentialRampToValueAtTime(e,this._context.currentTime+t),this._fadeTimer=a.default.setTimeout((function(){i.volume(e),a.default.clearTimeout(i._fadeTimer),i._fadeTimer=null,i._fading=!1,i._fadeEndCallback&&i._fadeEndCallback(i)}),1e3*t),this}},{key:"fadeStop",value:function(){return this._fading?(this._gainNode.gain.cancelScheduledValues(this._context.currentTime),this._fadeTimer&&(a.default.clearTimeout(this._fadeTimer),this._fadeTimer=null),this._fading=!1,this.volume(this._gainNode.gain.value),this):this}},{key:"rate",value:function(e){if(void 0===e)return this._rate;if(this._rate=e,this._rateSeek=this.seek(),this.isPlaying())if(this._stream){if(this._audio.playbackRate=e,this._isSprite){this._clearEndTimer();var t=this._getTimeVars(),i=n(t,2)[1];this._endTimer=a.default.setTimeout(this._onHtml5Ended,1e3*i/Math.abs(e))}}else this._startTime=this._context.currentTime,this._bufferSourceNode&&this._bufferSourceNode.playbackRate.setValueAtTime(e,this._context.currentTime);return this}},{key:"seek",value:function(e){if(void 0===e){if(this._stream)return this._audio?this._audio.currentTime:null;var t=this.isPlaying()?this._context.currentTime-this._startTime:0,i=this._rateSeek?this._rateSeek-this._currentPos:0;return this._currentPos+(i+t*this._rate)}if(e<this._startPos||e>this._endPos)return this;var n=this.isPlaying();return n&&this.pause(),this._currentPos=e,n&&this.play(),this}},{key:"loop",value:function(e){return"boolean"!=typeof e?this._loop:(this._loop=e,this._setLoop(e),this)}},{key:"destroy",value:function(){return this._state===l.Destroyed?this:(this.stop(),this._destroyAudio(),this._destroyMediaSourceNode(),this._gainNode&&this._gainNode.disconnect(),this._buffer=null,this._context=null,this._gainNode=null,this._state=l.Destroyed,this._destroyCallback&&this._destroyCallback(this),this)}},{key:"id",value:function(){return this._id}},{key:"muted",value:function(){return this._muted}},{key:"state",value:function(){return this._state}},{key:"duration",value:function(){return this._duration}},{key:"isPlaying",value:function(){return this._state===l.Playing}},{key:"isPaused",value:function(){return this._state===l.Paused}},{key:"lastPlayed",value:function(){return this._lastPlayed}},{key:"persist",value:function(){this._state!==l.Destroyed&&(this._persist=!0)}},{key:"abandon",value:function(){this._state!==l.Destroyed&&(this._persist=!1)}},{key:"isPersistent",value:function(){return this._persist}},{key:"canPlay",value:function(){return!!this._audio&&this._audio.readyState>=3}},{key:"_onAudioError",value:function(e){this._audioErrorCallback&&this._audioErrorCallback(this,e)}},{key:"_getTimeVars",value:function(){var e=Math.max(0,this._currentPos>0?this._currentPos:this._startPos),t=this._endPos-this._startPos;return[e,t,1e3*t/this._rate]}},{key:"_playBuffer",value:function(){var e=this._getTimeVars(),t=n(e,2),i=t[0],r=t[1];this._bufferSourceNode=this._context.createBufferSource(),this._bufferSourceNode.buffer=this._buffer,this._bufferSourceNode.playbackRate.setValueAtTime(this._rate,this._context.currentTime),this._setLoop(this._loop),this._bufferSourceNode.connect(this._gainNode),this._bufferSourceNode.addEventListener("ended",this._onBufferEnded);var o=this._context.currentTime;void 0!==this._bufferSourceNode.start?this._bufferSourceNode.start(o,i,this._loop?void 0:r):this._bufferSourceNode.noteGrainOn(o,i,this._loop?void 0:r)}},{key:"_playHtml5",value:function(){var e=this._getTimeVars(),t=n(e,3),i=t[0],r=t[2];this._audio.currentTime=i,this._isSprite?this._endTimer=a.default.setTimeout(this._onHtml5Ended,r):this._audio.addEventListener("ended",this._onHtml5Ended),this._audio.play()}},{key:"_onBufferEnded",value:function(){this._lastPlayed=new Date,this._currentPos=0,this._rateSeek=0,this._destroyBufferNode(),this._state=l.Ready,this._playEndCallback&&this._playEndCallback(this)}},{key:"_onHtml5Ended",value:function(){this._loop?this.stop().play():(this.stop(),this._state=l.Ready,this._playEndCallback&&this._playEndCallback(this))}},{key:"_clearEndTimer",value:function(){this._endTimer&&(a.default.clearTimeout(this._endTimer),this._endTimer=null)}},{key:"_onCanPlayThrough",value:function(){this._loadCallback(),this._audio.removeEventListener("canplaythrough",this._onCanPlayThrough)}},{key:"_gain",value:function(){return this._gainNode}},{key:"_destroyBufferNode",value:function(){this._bufferSourceNode&&(void 0!==this._bufferSourceNode.stop?this._bufferSourceNode.stop():this._bufferSourceNode.noteGrainOff(),this._bufferSourceNode.disconnect(),this._bufferSourceNode.removeEventListener("ended",this._onBufferEnded),this._bufferSourceNode=null)}},{key:"_destroyMediaSourceNode",value:function(){this._mediaElementAudioSourceNode&&(this._mediaElementAudioSourceNode.disconnect(),this._mediaElementAudioSourceNode=null)}},{key:"_destroyAudio",value:function(){this._audio&&(this._audio.removeEventListener("canplaythrough",this._onCanPlayThrough),this._audio.removeEventListener("error",this._onAudioError),this._audio.pause(),s.default.isIE()&&(this._audio.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),this._audio.onerror=null,this._audio.onend=null,this._audio.canplaythrough=null,this._audio=null)}},{key:"_setLoop",value:function(e){this._sourceExists&&(this._stream?this._audio.loop=e:(this._bufferSourceNode.loop=e,e&&(this._bufferSourceNode.loopStart=this._startPos,this._bufferSourceNode.loopEnd=this._endPos)))}}]),e}();t.default=d,t.SoundState=l},function(e,t,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(2),s=c(o),a=c(i(5)),u=c(i(0)),l=c(i(4)),d=c(i(6)),h=c(i(1)),f=c(i(12));function c(e){return e&&e.__esModule?e:{default:e}}var _={Ready:"ready",Destroyed:"destroyed"},y={Load:"load",LoadProgress:"loadprogress",UnLoad:"unload",PlayStart:"playstart",PlayEnd:"playend",Pause:"pause",Stop:"stop",Volume:"volume",Mute:"mute",Seek:"seek",Rate:"rate",FadeStart:"fadestart",FadeEnd:"fadeend",FadeStop:"fadestop",Error:"error",Destroy:"destroy"},p=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=-1,this._src=null,this._format=[],this._sprite=null,this._stream=!1,this._volume=1,this._rate=1,this._muted=!1,this._loop=!1,this._preload=!1,this._autoplay=!1,this._duration=0,this._compatibleSrc=null,this._loadState=f.default.NotLoaded,this._state=_.Ready,this._fading=!1,this._fadeTimer=null,this._noOfLoadCalls=0,this._soundsArray=[],this._audioNodes=[],this._queue=null,this._engine=null,this._context=null,this._gainNode=null,this._engine=s.default,this._onLoadProgress=this._onLoadProgress.bind(this),"string"==typeof t)t.startsWith("#")?this._setSource(t):this._src=[t];else if(Array.isArray(t)&&t.length)this._src=t;else if("object"===(void 0===t?"undefined":n(t))){var i=t.id,r=t.src,l=t.format,d=t.sprite,h=t.stream,c=t.volume,p=t.rate,v=t.muted,m=t.loop,b=t.preload,g=t.autoplay,k=t.onload,A=t.onloadprogress,S=t.onunload,E=t.onplaystart,P=t.onplayend,T=t.onpause,w=t.onstop,N=t.onmute,C=t.onvolume,x=t.onrate,L=t.onseek,M=t.onerror,I=t.ondestroy;this._id="number"==typeof i?i:u.default.id(),"string"==typeof r?r.startsWith("#")?this._setSource(r):this._src=[r]:Array.isArray(r)&&(this._src=r),Array.isArray(l)?this._format=l:"string"==typeof l&&l&&(this._format=[l]),"object"===(void 0===d?"undefined":n(d))&&(this._sprite=d),"boolean"==typeof h&&(this._stream=h),"number"==typeof c&&c>=0&&c<=1&&(this._volume=c),"number"==typeof p&&p>=.5&&p<=5&&(this._rate=p),"boolean"==typeof v&&(this._muted=v),"boolean"==typeof m&&(this._loop=m),"boolean"==typeof b&&(this._preload=b),"boolean"==typeof g&&(this._autoplay=g),"function"==typeof k&&this.on(y.Load,k),"function"==typeof A&&this.on(y.LoadProgress,A),"function"==typeof S&&this.on(y.UnLoad,S),"function"==typeof E&&this.on(y.PlayStart,E),"function"==typeof P&&this.on(y.PlayEnd,P),"function"==typeof T&&this.on(y.Pause,T),"function"==typeof w&&this.on(y.Stop,w),"function"==typeof N&&this.on(y.Mute,N),"function"==typeof C&&this.on(y.Volume,C),"function"==typeof x&&this.on(y.Rate,x),"function"==typeof L&&this.on(y.Seek,L),"function"==typeof M&&this.on(y.Error,M),"function"==typeof I&&this.on(y.Destroy,I)}if(!this._src.length)throw new Error("You should pass the source for the audio.");if(this._queue=new a.default,this._engine.setup(),!this._engine.isAudioAvailable())return this._fire(y.Error,null,{type:o.ErrorType.NoAudio,error:"Web Audio is un-available"}),this;this._context=this._engine.context(),this._engine.add(this),this._gainNode=this._engine.context().createGain(),this._gainNode.gain.setValueAtTime(this._muted?0:this._volume,this._context.currentTime),this._gainNode.connect(this._engine.masterGain()),this._engine.on(o.EngineEvents.Resume,this._onEngineResume=this._onEngineResume.bind(this)),this._autoplay?this.play():this._preload&&this.load()}return r(e,[{key:"load",value:function(e){var t=this;if(e){var i=this.sound(e);return i&&i.load(),this}if(!this._stream&&this._loadState!==f.default.NotLoaded)return this;this._loadState=f.default.Loading,this._noOfLoadCalls=this._noOfLoadCalls+1;var n=this._compatibleSrc||(this._compatibleSrc=this.getCompatibleSource());return(this._stream?this._engine.allocateForGroup(n,this._id):this._engine.load(n,this._onLoadProgress)).then((function(e){if(t._noOfLoadCalls>0&&(t._noOfLoadCalls=t._noOfLoadCalls-1),t._state!==_.Destroyed&&t._loadState!==f.default.NotLoaded)return e.status===h.default.Success?(t._stream?t._duration=e.value.duration:(t._buffer=e.value,t._duration=t._buffer.duration),t._loadState=f.default.Loaded,t._fire(y.Load,null,e),t._engine.state()!==o.EngineState.Ready?void t._queue.remove("after-load"):void t._queue.run("after-load")):void t._onLoadFailure(e.error);t._stream&&t._engine.releaseForGroup(t._compatibleSrc,t._id)})),this}},{key:"getCompatibleSource",value:function(){return this._format.length?this._src[this._format.indexOf(u.default.getSupportedFormat(this._format))]:u.default.getSupportedSource(this._src)}},{key:"play",value:function(e){var t=this;if("number"==typeof e){var i=this.sound(e);return i&&this._play(i),this}var n=u.default.id(),r={id:n,stream:this._stream,volume:this._volume,rate:this._rate,muted:this._muted,loop:this._loop,playEndCallback:function(){return t._fire(y.PlayEnd,n)},fadeEndCallback:function(){return t._fire(y.FadeEnd,n)},audioErrorCallback:function(e,i){return t._fire(y.Error,n,{type:o.ErrorType.LoadError,error:i})},loadCallback:function(){return t._fire(y.Load,n)},destroyCallback:function(){t._removeSound(n),t._engine.releaseForSound(t._compatibleSrc,t._id,n),t._fire(y.Destroy,n),l.default.clear(n)}};if("string"==typeof e&&this._sprite&&this._sprite.hasOwnProperty(e)){var s=this._sprite[e];r.startPos=s[0],r.endPos=s[1]}var a=new d.default(r);a._gain().connect(this._gainNode),this._soundsArray.push(a);var h=function(){a.source(t._stream?t._engine.allocateForSound(t._compatibleSrc,t._id,n):t._buffer),t._play(a)};return this.isLoaded()?h():(this._queue.add("after-load","play-"+n,(function(){return h()})),this.load()),n}},{key:"pause",value:function(e){var t=void 0===e;return this._removePlayActions(e),t&&this.fadeStop(),this._sounds(e).forEach((function(e){return e.pause()})),this._fire(y.Pause,e),this}},{key:"stop",value:function(e){var t=void 0===e;return this._removePlayActions(e),t&&this.fadeStop(),this._sounds(e).forEach((function(e){return e.stop()})),this._fire(y.Stop,e),this}},{key:"mute",value:function(e){if(void 0===e)this.fadeStop(),this._gainNode.gain.setValueAtTime(0,this._context.currentTime),this._muted=!0;else{var t=this.sound(e);t&&t.mute()}return this._fire(y.Mute,e,this._muted),this}},{key:"unmute",value:function(e){if(void 0===e)this.fadeStop(),this._gainNode.gain.setValueAtTime(this._volume,this._context.currentTime),this._muted=!1;else{var t=this.sound(e);t&&t.unmute()}return this._fire(y.Mute,e,this._muted),this}},{key:"volume",value:function(e,t){var i=void 0===t;if("number"==typeof e&&e>=0&&e<=1){if(i)this.fadeStop(),this._gainNode.gain.setValueAtTime(this._muted?0:e,this._context.currentTime),this._volume=e;else{var n=this.sound(t);n&&n.volume(e)}return this._fire(y.Volume,t,this._volume),this}if(!i){var r=this.sound(t);return r?r.volume():null}return this._volume}},{key:"fade",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"linear",r=arguments[3],o=void 0===r;if(o&&this._fading)return this;if(this._fire(y.FadeStart,r),o)this._fading=!0,"linear"===n?this._gainNode.gain.linearRampToValueAtTime(e,this._context.currentTime+t):this._gainNode.gain.exponentialRampToValueAtTime(e,this._context.currentTime+t),this._fadeTimer=setTimeout((function(){i.volume(e),clearTimeout(i._fadeTimer),i._fadeTimer=null,i._fading=!1,i._fire(y.FadeEnd)}),1e3*t);else{var s=this.sound(r);s&&s.fade(e,t,n)}return this}},{key:"fadeStop",value:function(e){if(void 0===e){if(!this._fading)return this;this._gainNode.gain.cancelScheduledValues(this._context.currentTime),this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null),this._fading=!1}else{var t=this.sound(e);t&&t.fadeStop()}return this._fire(y.FadeStop,e),this}},{key:"rate",value:function(e,t){var i=void 0===t;if("number"==typeof e&&e>=.5&&e<=5)return this._sounds(t).forEach((function(t){return t.rate(e)})),i&&(this._rate=e),this._fire(y.Rate,t,this._rate),this;if(!i){var n=this.sound(t);return n?n.rate():null}return this._rate}},{key:"seek",value:function(e,t){var i=this,n=this.sound(e);return n?"number"==typeof t?this.isLoaded()?(n.seek(t),this._fire(y.Seek,e,t),this):(this._queue.add("after-load","seek-"+e,(function(){return i.seek(e,t)})),this.load(),this):n.seek():this}},{key:"loop",value:function(e,t){var i=void 0===t;if("boolean"==typeof e)return this._sounds(t).forEach((function(t){return t.loop(e)})),i&&(this._loop=e),this;if(!i){var n=this.sound(t);return n?n.loop():null}return this._loop}},{key:"playing",value:function(e){var t=this.sound(e);return t?t.isPlaying():null}},{key:"muted",value:function(e){if(void 0===e)return this._muted;var t=this.sound(e);return t?t.muted():null}},{key:"state",value:function(e){if(void 0===e)return this._state;var t=this.sound(e);return t?t.state():null}},{key:"duration",value:function(e){if(void 0===e)return this._duration;var t=this.sound(e);return t?t.duration():null}},{key:"unload",value:function(){return this._queue.remove("after-load"),this._stream&&this._engine.releaseForGroup(this._compatibleSrc,this._id),this._buffer=null,this._duration=0,this._loadState=f.default.NotLoaded,this._noOfLoadCalls=0,this._fire(y.UnLoad),this}},{key:"destroy",value:function(e){if(e){var t=this.sound(e);t&&t.destroy()}else this._state!==_.Destroyed&&(this.stop(),this._soundsArray.forEach((function(e){return e.destroy()})),this._queue.clear(),this._engine.off(o.EngineEvents.Resume,this._onEngineResume),this._stream&&this._engine.releaseForGroup(this._compatibleSrc,this._id),this._gainNode.disconnect(),this._engine.remove(this),this._soundsArray=[],this._buffer=null,this._queue=null,this._context=null,this._engine=null,this._gainNode=null,this._state=_.Destroyed,this._fire(y.Destroy),l.default.clear(this._id))}},{key:"persist",value:function(e){var t=this.sound(e);t&&t.persist()}},{key:"abandon",value:function(e){var t=this.sound(e);t&&t.abandon()}},{key:"free",value:function(){var e=this,t=new Date;this._soundsArray=this._soundsArray.filter((function(i){var n=(t-i.lastPlayed())/1e3;return!!(i.isPersistent()||i.isPlaying()||i.isPaused()||n<60*e._engine.inactiveTime())||(i.destroy(),!1)}))}},{key:"on",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments[3];return l.default.on(n||this._id,e,t,i),this}},{key:"off",value:function(e,t,i){return l.default.off(i||this._id,e,t),this}},{key:"id",value:function(){return this._id}},{key:"gain",value:function(){return this._gainNode}},{key:"loadState",value:function(){return this._loadState}},{key:"isLoaded",value:function(){return this._stream?this._engine.hasFreeNodes(this._compatibleSrc,this._id):this._loadState===f.default.Loaded}},{key:"sound",value:function(e){return this._soundsArray.find((function(t){return t.id()===e}))}},{key:"sounds",value:function(){return this._soundsArray}},{key:"alive",value:function(e){return Boolean(this.sound(e))}},{key:"_setSource",value:function(e){var t=this._engine.getSource(e.substring(1));if("string"==typeof t)this._src=[t];else if(Array.isArray(t))this._src=t;else if("object"===(void 0===t?"undefined":n(t))){var i=t.url,r=t.format,o=t.sprite;"string"==typeof i?this._src=[i]:Array.isArray(i)&&(this._src=i),Array.isArray(r)?this._format=r:"string"==typeof r&&r&&(this._format=[r]),"object"===(void 0===o?"undefined":n(o))&&(this._sprite=o)}}},{key:"_onLoadFailure",value:function(e){0===this._noOfLoadCalls&&this._queue.remove("after-load"),this._loadState=f.default.NotLoaded,this._fire(y.Error,null,{type:o.ErrorType.LoadError,error:e})}},{key:"_onLoadProgress",value:function(e){this._fire(y.LoadProgress,null,e.percentageDownloaded)}},{key:"_onEngineResume",value:function(){this._queue.run("after-engine-resume")}},{key:"_play",value:function(e){var t=this;if(this._engine.state()!==o.EngineState.Destroying&&this._engine.state()!==o.EngineState.Done)if(this._engine.state()!==o.EngineState.NoAudio){var i=function(){e.play(),t._fire(y.PlayStart,e.id())};if([o.EngineState.Suspending,o.EngineState.Suspended,o.EngineState.Resuming].indexOf(this._engine.state())>-1)return this._queue.add("after-engine-resume","sound-"+e.id(),(function(){return i()})),void(this._engine.state()!==o.EngineState.Resuming&&this._engine.resume());i()}else this._fire(y.Error,null,{type:o.ErrorType.NoAudio,error:"Web Audio is un-available"});else this._fire(y.Error,null,{type:o.ErrorType.PlayError,error:"The engine is stopping/stopped"})}},{key:"_removePlayActions",value:function(e){this._queue.remove("after-load",e?"play-"+e:null),this._queue.remove("after-engine-resume",e?"sound-"+e:null)}},{key:"_sounds",value:function(e){if("number"==typeof e){var t=this._soundsArray.find((function(t){return t.id()===e}));return t?[t]:[]}return this._soundsArray}},{key:"_removeSound",value:function(e){"number"!=typeof e?this._soundsArray.splice(this._soundsArray.indexOf(e),1):this._soundsArray=this._soundsArray.filter((function(t){return t.id()!==e}))}},{key:"_fire",value:function(e,t){for(var i=arguments.length,n=Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return t?(l.default.fire.apply(l.default,[t,e].concat(n,[this.sound(t),this])),l.default.fire.apply(l.default,[this._id,e].concat(n,[this.sound(t),this]))):l.default.fire.apply(l.default,[this._id,e].concat(n,[this])),this}}]),e}(),v=function(e){return new p(e)};["setup","play","pause","register","unregister","getSource","load","loadMedia","unload","unloadMedia","mute","unmute","volume","fade","fadeStop","rate","seek","loop","destroy","stop","suspend","resume","terminate","muted","state","context","masterGain","isAudioAvailable","bufferLoader","mediaLoader","on","off","buzz","buzzes","sound","sounds"].forEach((function(e){v[e]=function(){var t=s.default[e].apply(s.default,arguments);return t===s.default?v:t}})),e.exports=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=s(i(0)),o=s(i(3));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._context=null,this._bufferCache={},this._progressCallsAndCallbacks={},this._disposed=!1,this._context=t}return n(e,[{key:"load",value:function(e,t){var i=this;return"string"==typeof e?this._load(e,t):Promise.all(e.map((function(e){return i._load(e,t)})))}},{key:"unload",value:function(e){var t=this;"string"!=typeof e?Array.isArray(e)?e.forEach((function(e){return t._unload(e)}),this):this._bufferCache={}:this._unload(e)}},{key:"dispose",value:function(){this._disposed||(this.unload(),this._bufferCache=null,this._progressCallsAndCallbacks=null,this._context=null,this._disposed=!0)}},{key:"_load",value:function(e,t){var i=this;return new Promise((function(n){if(i._bufferCache.hasOwnProperty(e))n(new o.default(e,i._bufferCache[e]));else if(i._progressCallsAndCallbacks.hasOwnProperty(e))i._progressCallsAndCallbacks[e].push(n);else{i._progressCallsAndCallbacks[e]=[],i._progressCallsAndCallbacks[e].push(n);var s=function(t){i._disposed||(i._progressCallsAndCallbacks[e].forEach((function(i){return i(new o.default(e,null,t))})),delete i._progressCallsAndCallbacks[e])},a=function(t){i._disposed||i._context.decodeAudioData(t,(function(t){i._bufferCache[e]=t,i._progressCallsAndCallbacks[e].forEach((function(i){return i(new o.default(e,t))})),delete i._progressCallsAndCallbacks[e]}),s)};if(r.default.isBase64(e)){for(var u=atob(e.split(",")[1]),l=new Uint8Array(u.length),d=0;d<u.length;d++)l[d]=u.charCodeAt(d);a(l.buffer)}else{var h=new XMLHttpRequest;h.open("GET",e,!0),h.responseType="arraybuffer",h.addEventListener("load",(function(){return a(h.response)}),!1),t&&h.addEventListener("progress",(function(i){i.lengthComputable||t({url:e,percentageDownloaded:0});var n=Math.round(i.loaded/i.total*100);t({url:e,percentageDownloaded:n})})),h.addEventListener("error",s,!1),h.send()}}}))}},{key:"_unload",value:function(e){delete this._bufferCache[e]}}]),e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=s(i(10)),o=s(i(3));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._audioPool=null,this._bufferingAudios=[],this._disposed=!1,this._audioPool=new r.default(t,i,n)}return n(e,[{key:"load",value:function(e){var t=this;return"string"==typeof e?this._load(e):Promise.all(e.map((function(e){return t._load(e)})))}},{key:"allocateForGroup",value:function(e,t){return this._load(e,t)}},{key:"allocateForSound",value:function(e,t,i){return this._audioPool.allocateForSound(e,t,i)}},{key:"unload",value:function(e){var t=this,i=function(e){var i=t._bufferingAudios.find((function(t){return t.url===e}));i&&t._cleanUp(i)};e?"string"==typeof e?(i(e),this._audioPool.releaseForSource(e)):Array.isArray(e)&&e.length&&e.forEach((function(e){i(e),t._audioPool.releaseForSource(e)})):(this._bufferingAudios.forEach((function(e){return t._cleanUp(e)})),this._audioPool.release())}},{key:"releaseForGroup",value:function(e,t){var i=this;this._bufferingAudios.filter((function(e){return e.groupId===t})).forEach((function(e){return i._cleanUp(e)})),this._audioPool.releaseForGroup(e,t)}},{key:"releaseForSound",value:function(e,t,i){this._audioPool.releaseAudio(e,t,i)}},{key:"hasFreeNodes",value:function(e,t){return this._audioPool.hasFreeNodes(e,t)}},{key:"cleanUp",value:function(){this._audioPool.cleanUp()}},{key:"dispose",value:function(){var e=this;this._disposed||([].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(this._bufferingAudios)).forEach((function(t){return e._cleanUp(t)})),this._bufferingAudios=null,this._audioPool.dispose(),this._audioPool=null,this._disposed=!0)}},{key:"_load",value:function(e,t){var i=this;return new Promise((function(n){var r=t?i._audioPool.allocateForGroup(e,t):i._audioPool.allocateForSource(e),s=function(){if(!i._disposed){var t=i._bufferingAudios.find((function(e){return e.audio===r}));t&&i._cleanUp(t),n(new o.default(e,r))}},a=function(s){if(!i._disposed){var a=i._bufferingAudios.find((function(e){return e.audio===r}));a&&i._cleanUp(a),i._audioPool.releaseAudio(e,t,r),n(new o.default(e,null,s))}};if(r.addEventListener("canplaythrough",s),r.addEventListener("error",a),i._bufferingAudios.push({url:e,groupId:t,audio:r,canplaythrough:s,error:a}),!r.src)return r.src=e,void r.load();r.currentTime=0,r.readyState>=3&&s()}))}},{key:"_cleanUp",value:function(e){["canplaythrough","error"].forEach((function(t){return e.audio.removeEventListener(t,e[e])})),this._bufferingAudios.splice(this._bufferingAudios.indexOf(e),1)}}]),e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(0),s=(n=o)&&n.__esModule?n:{default:n};var a=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._maxNodesPerSource=100,this._inactiveTime=2,this._soundCleanUpCallback=null,this._resourceNodesMap={},this._cleanUpCalled=!1,this._maxNodesPerSource=t,this._inactiveTime=i,this._soundCleanUpCallback=n}return r(e,[{key:"allocateForSource",value:function(e){this._createSrc(e),this._checkMaxNodesForSrc(e);var t=this._resourceNodesMap[e].unallocated,i=new Audio;return t.push({audio:i,time:new Date}),i}},{key:"allocateForGroup",value:function(e,t){this._createGroup(e,t),this._checkMaxNodesForSrc(e);var i=this._resourceNodesMap[e],n=i.unallocated,r=i.allocated,o=n.length?n.shift().audio:new Audio;return r[t].push({soundId:null,audio:o,time:new Date}),o}},{key:"allocateForSound",value:function(e,t,i){this._createGroup(e,t);var n=this._resourceNodesMap[e].allocated[t].find((function(e){return null===e.soundId}));if(!n)throw new Error("No free audio nodes available in the group "+t);return n.soundId=i,n.audio}},{key:"release",value:function(){var e=this;Object.keys(this._resourceNodesMap).forEach((function(t){return e.releaseForSource(t)}))}},{key:"releaseForSource",value:function(e){var t=this,i=this._resourceNodesMap[e],n=i.unallocated,r=i.allocated;n.forEach((function(e){return t._destroyNode(e.audio)})),Object.keys(r).forEach((function(i){return t.releaseForGroup(e,i)})),delete this._resourceNodesMap[e]}},{key:"releaseForGroup",value:function(e,t){var i=this,n=this._resourceNodesMap[e].allocated;n[t].map((function(e){return e.audio})).forEach((function(e){return i._destroyNode(e)})),delete n[t]}},{key:"releaseAudio",value:function(e,t,i){var n=this._resourceNodesMap[e],r=n.allocated,o=n.unallocated;if(i instanceof Audio)this._destroyNode(i),t?r[t]=r[t].filter((function(e){return e.audio!==i})):n.unallocated=o.filter((function(e){return e.audio!==i}));else{var s=r[t].find((function(e){return e.soundId===i}));this._destroyNode(s.audio),r[t]=r[t].filter((function(e){return e.soundId!==i}))}t&&!r[t].length&&delete r[t],!o.length&&!Object.keys(r).length&&delete this._resourceNodesMap[e]}},{key:"cleanUp",value:function(){var e=this,t=new Date;Object.keys(this._resourceNodesMap).forEach((function(i){var n=e._resourceNodesMap[i],r=n.unallocated,o=n.allocated;Object.keys(o).forEach((function(i){var n=o[i].filter((function(i){return null===i.soundId&&(t-i.time)/1e3>60*e._inactiveTime}));o[i]=o[i].filter((function(e){return-1===n.indexOf(e)})),n.forEach((function(t){return e._destroyNode(t.audio)}))}));var s=r.filter((function(i){return(t-i.time)/1e3>60*e._inactiveTime}));n.unallocated=r.filter((function(e){return-1===s.indexOf(e)})),s.forEach((function(t){return e._destroyNode(t.audio)}))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this._resourceNodesMap).forEach((function(t){return e.releaseForSource(t)}))}},{key:"hasFreeNodes",value:function(e,t){if(!this._resourceNodesMap.hasOwnProperty(e))return!1;var i=this._resourceNodesMap[e],n=i.unallocated,r=i.allocated;return t?r[t].filter((function(e){return null===e.soundId})).length>0:n.length>0}},{key:"_createSrc",value:function(e){this._resourceNodesMap.hasOwnProperty(e)||(this._resourceNodesMap[e]={unallocated:[],allocated:{}})}},{key:"_createGroup",value:function(e,t){this._createSrc(e);var i=this._resourceNodesMap[e].allocated;i.hasOwnProperty(t)||(i[t]=[])}},{key:"_checkMaxNodesForSrc",value:function(e){if(this._resourceNodesMap.hasOwnProperty(e)){var t=this._resourceNodesMap[e],i=t.unallocated,n=t.allocated,r=0;if(Object.keys(n).forEach((function(e){r+=n[e].length})),!(i.length+r<this._maxNodesPerSource))throw this._cleanUpCalled||(this.cleanUp(),this._soundCleanUpCallback(e),this._cleanUpCalled=!0,this._checkMaxNodesForSrc(e)),this._cleanUpCalled=!1,new Error("Maximum nodes reached for resource "+e)}}},{key:"_destroyNode",value:function(e){e.pause(),s.default.isIE()&&(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),e.onerror=null,e.onend=null,e.canplaythrough=null}}]),e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._worker=null,this._isWorkerThreadAvailable=!1,this._timerCallbacks={},this._timerId=0,this._handleMessage=this._handleMessage.bind(this)}return n(e,[{key:"init",value:function(){if(Worker&&!this._worker){var e=this._getBlob("\n  var timerIds = {}, timeoutWorker = {};\n  \n  timeoutWorker.setTimeout = function(timerId, duration) {\n    timerIds[timerId] = setTimeout(function() {\n      postMessage({ timerId: timerId });\n    }, duration);\n  };\n  \n  timeoutWorker.clearTimeout = function(timerId) {\n    clearTimeout(timerIds[timerId]);\n  };\n  \n  timeoutWorker.setInterval = function(timerId, duration) {\n    timerIds[timerId] = setInterval(function() {\n      postMessage({ timerId: timerId });\n    }, duration);\n  };\n  \n  timeoutWorker.clearInterval = function(timerId) {\n    clearInterval(timerIds[timerId]);\n  };\n  \n  onmessage = function(e) {\n    var command = e.data.command;\n    timeoutWorker[command](e.data.timerId, e.data.duration);\n  };\n");if(null!==e){var t=this._createObjectURL(e);null!==t&&(this._worker=new Worker(t),this._worker.addEventListener("message",this._handleMessage),this._isWorkerThreadAvailable=!0)}}}},{key:"_getBlob",value:function(e){var t=null;try{t=new Blob([e],{type:"application/javascript"})}catch(n){var i=null;"undefined"!=typeof BlobBuilder?i=BlobBuilder:"undefined"!=typeof WebKitBlobBuilder&&(i=WebKitBlobBuilder),(t=new i).append(e),t=t.getBlob()}return t}},{key:"_createObjectURL",value:function(e){return"undefined"!=typeof URL&&URL.createObjectURL?URL.createObjectURL(e):"undefined"!=typeof webkitURL?webkitURL.createObjectURL(e):null}},{key:"_handleMessage",value:function(e){var t=this._timerCallbacks[e.data.timerId];t&&t.cb&&t.cb(),t.repeat||delete this._timerCallbacks[e.data.timerId]}},{key:"setTimeout",value:function(e){function t(t,i){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return this._isWorkerThreadAvailable?(this._timerId=this._timerId+1,this._timerCallbacks[this._timerId]={cb:e,repeat:!1},this._worker.postMessage({command:"setTimeout",timerId:this._timerId,duration:t}),this._timerId):setTimeout(e,t)}))},{key:"clearTimeout",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){if(!this._isWorkerThreadAvailable)return clearTimeout(e);this._worker.postMessage({command:"clearTimeout",timerId:e}),delete this._timerCallbacks[e]}))},{key:"setInterval",value:function(e){function t(t,i){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return this._isWorkerThreadAvailable?(this._timerId=this._timerId+1,this._timerCallbacks[this._timerId]={cb:e,repeat:!0},this._worker.postMessage({command:"setInterval",timerId:this._timerId,duration:t}),this._timerId):setInterval(e,t)}))},{key:"clearInterval",value:function(e){if(!this._isWorkerThreadAvailable)return clearTimeout(e);this._worker.postMessage({command:"clearTimeout",timerId:e}),delete this._timerCallbacks[e]}},{key:"terminate",value:function(){this._worker&&(this._worker.removeEventListener("message",this._handleMessage),this._worker.terminate(),this._worker=null),this._isWorkerThreadAvailable=!1,this._timerCallbacks={},this._timerId=0}}]),e}();t.default=new r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={NotLoaded:"notloaded",Loading:"loading",Loaded:"loaded"}}])}));
//# sourceMappingURL=musquito-3.0.0.min.js.map